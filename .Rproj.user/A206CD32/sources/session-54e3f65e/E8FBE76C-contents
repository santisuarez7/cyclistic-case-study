---
title: "Cyclistic Case Study"
author: "Santiago Suárez"
date: "2025-12-30"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)

all_trips <- read_csv("/cloud/project/data/all_trips_clean.csv")
```

### Sobre Cyclistic
Cyclistic es una empresa ficticia que cuenta con un sistema bicicletas compartidas
y tiene base en Chicago, Estados Unidos. La compañía ofrece pases por viaje individual,
pases diarios y membresías anuales.

### 1. Business Task
Los directivos de la empresa creen que la clave para el crecimiento de Cyclistic es
maximizar el número de membresías anuales, debido a que son mucho mas rentables
para la compañía que los pases diarios o viajes individuales. 

El objetivo de la directora de marketing es diseñar estrategias de marketing con 
la finalidad de convertir a los usuarios casuales en miembros anuales.

Para lograr eso, primeramente el equipo necesita tener un mejor entendimiento sobre:
- ¿Cómo los miembros anuales difieren de los usuarios casuales en la manera de usar Cyclistic?
- ¿Por qué los usuarios casuales querrían adquirir la membresía anual de Cyclistic?
- ¿Como puede Cyclistic utilizar los medios digitales para influenciar a los usuarios
casuales a volverse miembros?

### 2. Fuentes de datos
El análisis fue hecho utilizando dos datasets (Divvy_Q1_2019 y Divvy_Q1_2020) 
proporcionados por Motivate International Inc.

### 3. Limpieza y preparación de datos
La limpieza y preparación de los datos se realizó en R utilizando principalmente
la colección **tidyverse**. El proceso incluyó los siguientes pasos:

- Carga de los datasets de viajes correspondientes al primer trimestre de 2019 y 2020.
- Revisión de la estructura, tipos de datos y valores nulos utilizando funciones
  como `glimpse()` y `skim_without_charts()` de `skimr`.
- Estandarización de nombres y formatos de columnas para que ambos datasets
  compartieran la misma estructura.
- Limpieza de imperfecciones en los nombres de columnas con `clean_names()` de `janitor`
- Conversión de los `trip_id` a un tipo de dato común (chr).
- Creación y calculación de `trip_duration` faltante en el dataset de 2020.
- Eliminación de columnas que no resultaban relevantes para el análisis.
- Normalización del tipo de usuario en dos categorías: `member` y `casual`.
- Unión de ambos datasets en un único conjunto de datos limpio para su análisis.
-	Detección de valores atípicos en la duración de los viajes, incluyendo viajes
extremadamente largos o con duraciones negativas.
-	Filtrado de viajes con duraciones menores a 1 minuto y mayores a 1 día, ya que
estos valores no representan viajes reales y podrían distorsionar los resultados del análisis.

### 4. Análisis
####### Análisis general por tipo de usuario
En primer lugar, se analizan métricas generales para comparar el comportamiento
de los miembros anuales y los usuarios casuales.

```{r}
all_trips %>% 
  group_by(user_type) %>% 
  summarize(
    cantidad_viajes = n(),
    duracion_promedio = mean(trip_duration),
    duracion_mediana = median(trip_duration),
    tiempo_total_viajado = sum(trip_duration),
  )
```

A partir de estos datos se observan grandes diferencias entre ambos tipos de usuarios:
	•	Los *miembros anuales* realizan una cantidad significativamente mayor de viajes.
	•	Los *usuarios casuales*, en cambio, presentan una duración promedio y mediana más alta.
	•	El tiempo total viajado es considerablemente mayor en los miembros, debido a la frecuencia de uso.
	
---

##### Análisis de la distribución del 80% de la duración de los viajes
Para profundizar el análisis, se analiza en qué rango de duración se concentra el 80% de los viajes de cada tipo de usuario. Este enfoque permite entender mejor la distribución
de las duraciones de los viajes. Más adelante se observará mejor gráficamente.

```{r}
duracion_80 <- all_trips %>% 
  filter(trip_duration < 5400) %>%          
  arrange(user_type, trip_duration) %>%    
  group_by(user_type) %>% 
  mutate(
    total_trips = n(),
    trip_index = row_number(),
    prop_acumulada = trip_index / total_trips
  ) %>% 
  filter(prop_acumulada >= 0.8) %>% 
  slice_min(trip_duration, n = 1) %>%         
  ungroup() %>% 
  distinct(user_type, trip_duration/60)

duracion_80
```

Los resultados muestran que:
	•	El 80% de los viajes de los *miembros anuales* tiene una duración de hasta ~15 minutos.
	•	El 80% de los viajes de los *usuarios casuales* tiene una duración de hasta ~38 minutos.

Esto indica que los *miembros* tienden a realizar trayectos cortos y funcionales,
mientras que los *usuarios casuales* presentan un uso más prolongado, asociado a
actividades recreativas o turísticas.


### 5. Visualizaciones y hallazgos clave
Distribución de la duración de los viajes por tipo de usuario

```{r}
# Violin plot
all_trips %>% 
  filter(trip_duration < 5400) %>% 
  ggplot(aes(x = user_type, y = trip_duration, fill = user_type)) +
  geom_violin(alpha = 0.8) +
  geom_boxplot(width = 0.2, outlier.shape = NA, alpha = 0.4) +
  scale_fill_manual(
    values = c(member = "#FED789FF", casual = "#72874EFF")
  ) +
  scale_y_continuous(
    breaks = seq(0, 5400, by = 900),
    labels = function(x) paste0(x / 60)
  ) +
  scale_x_discrete(
    labels = c(
      member = "Miembros Anuales",
      casual = "Usuarios Casuales"
    )
  ) +
  labs(
    title = "Duración de los viajes por tipo de usuario",
    subtitle = "Comparación entre miembros anuales y usuarios casuales",
    x = "Tipo de usuario",
    y = "Duración del viaje (min)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```

###### Hallazgos clave:
	•	Los miembros anuales concentran la mayoría de sus viajes en trayectos cortos (5 a 15 minutos).
	•	Los usuarios casuales presentan una distribución más dispersa, con viajes que suelen extenderse a duraciones mayores.
	•	Esto sugiere un uso funcional y recurrente por parte de los miembros, frente a un uso recreativo u ocasional por parte de los casuales.
	
---

Histograma de la duración de los viajes

```{r}
ggplot(all_trips, aes(x = trip_duration, fill = user_type)) +
  geom_histogram(
    binwidth = 300,
    color = "black",
    alpha = 0.8
  ) +
  facet_wrap(
    ~user_type,
    scales = "free_y",
    labeller = labeller(
      user_type = c(
        member = "Miembros Anuales",
        casual = "Usuarios Casuales"
      )
    )
  ) +
  coord_cartesian(xlim = c(0, 5300)) +
  scale_x_continuous(
    breaks = seq(0, 5400, by = 600),
    labels = function(x) paste0(x / 60)
  ) +
  scale_fill_manual(
    values = c(member = "#FED789FF", casual = "#72874EFF")
  ) +
  labs(
    title = "Distribución de la duración de los viajes",
    subtitle = "Frecuencia de viajes según su duración",
    x = "Duración del viaje (min)",
    y = "Cantidad de viajes"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  ) +
  scale_y_continuous(labels = scales::comma)
```


###### Hallazgos clave:
	•	En los miembros, la gran mayoría de los viajes se concentran en duraciones cortas, con una caída abrupta a partir de los ~15 minutos.
	•	En los usuarios casuales, la frecuencia disminuye de forma más gradual, indicando una mayor tolerancia a viajes largos.
	•	Este patrón refuerza la hipótesis de uso laboral vs. uso recreativo.


### 6. Recomendaciones
1. ...
2. ...
3. ...





