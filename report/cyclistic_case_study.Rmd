---
title: "Cyclistic Case Study"
author: "Santiago Suárez"
date: "2025-12-30"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)

all_trips <- read_csv("~/R/Cyclistic Case Study/data/all_trips_clean.csv")
```

### Sobre Cyclistic
Cyclistic es una empresa ficticia que cuenta con un sistema bicicletas compartidas
y tiene base en Chicago, Estados Unidos. La compañía ofrece pases por viaje individual,
pases diarios y membresías anuales.

### 1. Tarea Empresarial
Los directivos de la empresa creen que la clave para el crecimiento de Cyclistic es
maximizar el número de membresías anuales, debido a que son mucho mas rentables
para la compañía que los pases diarios o viajes individuales. 

El objetivo de la directora de marketing es diseñar estrategias de marketing con 
la finalidad de convertir a los usuarios casuales en miembros anuales.

Para lograr eso, primeramente el equipo necesita tener un mejor entendimiento sobre:

- ¿Cómo los miembros anuales difieren de los usuarios casuales en la manera de usar Cyclistic?
- ¿Por qué los usuarios casuales querrían adquirir la membresía anual de Cyclistic?
- ¿Como puede Cyclistic utilizar los medios digitales para influenciar a los usuarios
casuales a volverse miembros?

### 2. Fuentes de datos
El análisis fue hecho utilizando dos datasets (Divvy_Q1_2019 y Divvy_Q1_2020) 
proporcionados por Motivate International Inc.

<div style="color:#6c757d; font-size:0.9em;">
**Nota sobre los datos:**  
Los datasets utilizados corresponden únicamente al primer trimestre de 2019 y 2020.  
Por lo tanto, los patrones observados pueden estar influenciados por efectos
asociados al momento del año y no necesariamente representan el comportamiento
anual completo de los usuarios.
</div>

### 3. Limpieza y preparación de datos
La limpieza y preparación de los datos se realizó en R utilizando principalmente
la colección **tidyverse**. El proceso incluyó los siguientes pasos:

- Carga de los datasets de viajes correspondientes al primer trimestre de 2019 y 2020.
- Revisión de la estructura, tipos de datos y valores nulos utilizando funciones
  como `glimpse()` y `skim_without_charts()` de `skimr`.
- Estandarización de nombres y formatos de columnas para que ambos datasets
  compartieran la misma estructura.
- Limpieza de imperfecciones en los nombres de columnas con `clean_names()` de `janitor`
- Conversión de los `trip_id` a un tipo de dato común (chr).
- Creación y calculación de `trip_duration` faltante en el dataset de 2020.
- Eliminación de columnas que no resultaban relevantes para el análisis.
- Normalización del tipo de usuario en dos categorías: `member` y `casual`.
- Unión de ambos datasets en un único conjunto de datos limpio para su análisis.
-	Detección de valores atípicos en la duración de los viajes, incluyendo viajes
extremadamente largos o con duraciones negativas.
-	Filtrado de viajes con duraciones menores a 1 minuto y mayores a 1 día, ya que
estos valores no representan viajes reales y podrían distorsionar los resultados del análisis.

<div style="color:#6c757d; font-size:0.9em;">
**Decisión de limpieza relevante:**  
Se eliminaron viajes con duración menor a 1 minuto y mayor a 24 horas,
ya que no representan usos reales del servicio y podrían distorsionar
las métricas de duración y distribución.
</div>

### 4. Análisis
##### Análisis general por tipo de usuario
En primer lugar, se analizan métricas generales para comparar el comportamiento
de los miembros anuales y los usuarios casuales.

```{r}
all_trips %>% 
  group_by(user_type) %>% 
  summarize(
    cantidad_viajes = n(),
    duracion_promedio_s = mean(trip_duration),
    duracion_mediana_s = median(trip_duration),
    tiempo_total_viajado = sum(trip_duration),
  )
```

A partir de estos datos se observan grandes diferencias entre ambos tipos de usuarios:

- Los *miembros anuales* realizan una cantidad significativamente mayor de viajes.
- Los *usuarios casuales*, en cambio, presentan una duración promedio y mediana más alta.
- El tiempo total viajado es considerablemente mayor en los miembros, debido a la frecuencia de uso.
	
---

##### Análisis de la distribución del 80% de la duración de los viajes
Para profundizar el análisis, se analiza en qué rango de duración se concentra el 80% de los viajes de cada tipo de usuario. Este enfoque permite entender mejor la distribución
de las duraciones de los viajes. Más adelante se observará mejor gráficamente.

```{r}
duracion_80 <- all_trips %>% 
  filter(trip_duration < 5400) %>%          
  arrange(user_type, trip_duration) %>%    
  group_by(user_type) %>% 
  mutate(
    total_trips = n(),
    trip_index = row_number(),
    prop_acumulada = trip_index / total_trips
  ) %>% 
  filter(prop_acumulada >= 0.8) %>% 
  slice_min(trip_duration, n = 1) %>%         
  ungroup() %>% 
  distinct(user_type, trip_duration/60)

duracion_80
```

Los resultados muestran que:
	•	El 80% de los viajes de los *miembros anuales* tiene una duración de hasta ~15 minutos.
	•	El 80% de los viajes de los *usuarios casuales* tiene una duración de hasta ~38 minutos.

Esto indica que los *miembros* tienden a realizar trayectos cortos y funcionales,
mientras que los *usuarios casuales* presentan un uso más prolongado, asociado a
actividades recreativas o turísticas.


### 5. Visualizaciones y hallazgos clave
##### Distribución de la duración de los viajes por tipo de usuario

```{r}
# Violin plot
all_trips %>% 
  filter(trip_duration < 5400) %>% 
  ggplot(aes(x = user_type, y = trip_duration, fill = user_type)) +
  geom_violin(alpha = 0.8) +
  geom_boxplot(width = 0.2, outlier.shape = NA, alpha = 0.4) +
  scale_fill_manual(
    values = c(member = "#FED789FF", casual = "#72874EFF")
  ) +
  scale_y_continuous(
    breaks = seq(0, 5400, by = 900),
    labels = function(x) paste0(x / 60)
  ) +
  scale_x_discrete(
    labels = c(
      member = "Miembros Anuales",
      casual = "Usuarios Casuales"
    )
  ) +
  labs(
    title = "Duración de los viajes por tipo de usuario",
    subtitle = "Comparación entre miembros anuales y usuarios casuales",
    x = "Tipo de usuario",
    y = "Duración del viaje (min)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```

###### Hallazgos clave:
	•	Los miembros anuales concentran la mayoría de sus viajes en trayectos cortos (5 a 15 minutos).
	•	Los usuarios casuales presentan una distribución más dispersa, con viajes que suelen extenderse a duraciones mayores.
	•	Esto sugiere un uso funcional y recurrente por parte de los miembros, frente a un uso recreativo u ocasional por parte de los casuales.
	
---

##### Histograma de la duración de los viajes

```{r}
ggplot(all_trips, aes(x = trip_duration, fill = user_type)) +
  geom_histogram(
    binwidth = 300,
    color = "black",
    alpha = 0.8
  ) +
  facet_wrap(
    ~user_type,
    scales = "free_y",
    labeller = labeller(
      user_type = c(
        member = "Miembros Anuales",
        casual = "Usuarios Casuales"
      )
    )
  ) +
  coord_cartesian(xlim = c(0, 5300)) +
  scale_x_continuous(
    breaks = seq(0, 5400, by = 600),
    labels = function(x) paste0(x / 60)
  ) +
  scale_fill_manual(
    values = c(member = "#FED789FF", casual = "#72874EFF")
  ) +
  labs(
    title = "Distribución de la duración de los viajes",
    subtitle = "Frecuencia de viajes según su duración",
    x = "Duración del viaje (min)",
    y = "Cantidad de viajes"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  ) +
  scale_y_continuous(labels = scales::comma)
```

<div style="color:#6c757d; font-size:0.9em;">
*Nota:* Las proporciones se calcularon dentro de cada tipo de usuario para permitir una comparación relativa de patrones de uso.
</div>

###### Hallazgos clave:
	•	En los miembros, la gran mayoría de los viajes se concentran en duraciones cortas, con una caída abrupta a partir de los ~15 minutos.
	•	En los usuarios casuales, la frecuencia disminuye de forma más gradual, indicando una mayor tolerancia a viajes largos.
	•	Este patrón refuerza la hipótesis de uso laboral vs. uso recreativo.

---

##### Viajes realizados por día de la semana

```{r}
all_trips %>% 
  mutate(weekday = wday(start_time, label = TRUE)) %>%
  group_by(weekday, user_type) %>% 
  summarize(trips = n(), .groups = "drop") %>% 
  ggplot(aes(x = weekday, y = trips, fill = weekday)) +
  geom_col(alpha = 0.8) +
  facet_wrap(
    ~user_type,
    scales = "free_y",
    labeller = labeller(
      user_type = c(
        member = "Miembros Anuales",
        casual = "Usuarios Casuales"
      )
    )
  ) +
  theme_minimal() + 
  scale_fill_manual(values = c(
    "#935038", "#023743FF", "#014337",
    "#476F84FF", "#A4BED5FF", "#453947FF", "#731A1A"
  )) +   
  labs(
    title = "Viajes por día",
    subtitle = "Comparación entre miembros anuales y usuarios casuales",
    x = "Día de la semana",
    y = "Cantidad de viajes"
  ) +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  ) + 
  scale_y_continuous(labels = scales::comma)
```

<div style="color:#6c757d; font-size:0.9em;">
*Nota:* Las proporciones se calcularon dentro de cada tipo de usuario para permitir una comparación relativa de patrones de uso.
</div>

###### Hallazgos clave:
	•	Los miembros anuales concentran la mayor cantidad de viajes durante los días de semana, especialmente de lunes a viernes.
	•	Este comportamiento sugiere un uso más funcional y rutinario, probablemente asociado a actividades laborales o traslados diarios.
	•	Los usuarios casuales presentan un mayor uso durante los fines de semana.
	•	Al relacionar este gráfico con la duración de los viajes, se refuerza la idea de un uso recreativo u ocasional por parte de los usuarios casuales.
	
---

##### Uso del servicio por hora del día

```{r}
all_trips %>% 
  mutate(hour = hour(start_time)) %>% 
  group_by(hour, user_type) %>% 
  summarize(trips = n(), .groups = "drop") %>% 
  group_by(user_type) %>% 
  mutate(props = trips / sum(trips)) %>% 
  ggplot(aes(x = hour, y = props, color = user_type)) +
  geom_line(linewidth = 1.2) +
  geom_point(alpha = 0.8) +
  scale_color_manual(
    values = c(
      member = "#FED789FF",
      casual = "#72874EFF"
    ),
    labels = c(
      member = "Miembros",
      casual = "Casuales"
    )
  ) +
  scale_x_continuous(
    breaks = seq(0, 23, by = 2),
    labels = function(x) paste0(x, "hs")
  ) +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Distribución del uso por hora del día",
    subtitle = "Proporción de viajes por hora dentro de cada tipo de usuario",
    x = "Hora del día",
    y = "Proporción de viajes",
    color = "Tipo de usuario"
  ) +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```


###### Hallazgos clave:
	•	El uso de los miembros anuales presenta dos picos bien definidos, uno por la mañana (6–9 hs) y otro por la tarde (15–18 hs).
	•	Estos horarios coinciden con los momentos típicos de entrada y salida laboral (o algún establecimiento educativo), reforzando la hipótesis de un uso funcional del servicio.
	•	En los usuarios casuales, el uso se concentra principalmente entre las 12 y 18 hs, sin picos tan marcados.
	•	Este patrón horario es consistente con un uso recreativo, de ocio o turístico, en lugar de desplazamientos rutinarios.

---

##### Hora del día vs Día de la semana

```{r}
heatmap_data <- all_trips %>% 
  mutate(
    hour = hour(start_time),
    weekday = wday(start_time, label = TRUE)
  ) %>% 
  group_by(weekday, hour, user_type) %>% 
  summarize(trips = n(), .groups = "drop")

heatmap_data %>% 
  group_by(user_type) %>% 
  mutate(prop = trips / max(trips)) %>% 
  ggplot(aes(x = hour, y = weekday, fill = prop)) + 
  geom_tile() +
  facet_wrap(
    ~user_type,
    labeller = labeller(
      user_type = c(
        member = "Miembros Anuales",
        casual = "Usuarios Casuales"
      )
    )
  ) +
  scale_fill_gradient(
    low = "#02731E",
    high = "#F2E205",
    labels = scales::percent
  ) +
  scale_x_continuous(
    breaks = seq(0, 23, by = 2),
    labels = function(x) paste0(x, "hs")
  ) +
  labs(
    title = "Hora del día vs Día de la semana",
    subtitle = "Distribución de los viajes en cada hora de cada día de la semana",
    x = "Hora del día",
    y = "Día de la semana",
    fill = "Proporción"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45)
  )
```

###### Hallazgos clave:
	•	En los usuarios casuales, el mayor volumen de viajes se concentra desde el mediodía hasta la tarde (12–17 hs), especialmente durante los fines de semana.
	•	Durante los días de semana, el uso de los usuarios casuales disminuye notablemente, aunque sigue concentrándose en la franja de la tarde.
	•	Los miembros anuales presentan un patrón claramente distinto, con mayor intensidad de uso en la mañana y en la tarde-noche de los días de semana.
	•	En los siete días de la semana se observa un uso moderado alrededor del mediodía, aunque menos marcado que en los usuarios casuales.
	•	Este gráfico refuerza y visualiza de forma clara la diferencia entre un uso laboral/rutinario (miembros) y un uso recreativo u ocasional del servicio (casuales).
	
---

##### Estaciones más usadas por tipo de usuario

```{r}
top5_stations <- all_trips %>% 
  group_by(user_type, start_station_name) %>% 
  summarize(trips = n(), .groups = "drop") %>% 
  group_by(user_type) %>% 
  slice_max(order_by = trips, n = 5)

top5_stations %>% 
  ggplot(aes(
    x = trips,
    y = reorder(start_station_name, trips),
    fill = user_type
  )) +
  geom_col(alpha = 0.8) +
  scale_fill_manual(
    values = c(
      member = "#FED789FF",
      casual = "#72874EFF"
    ),
    labels = c(
      member = "Miembros",
      casual = "Casuales"
    )
  ) +
  scale_x_continuous(
    breaks = seq(0, 14000, by = 2000),
    labels = scales::comma
  ) +
  labs(
    title = "Estaciones más usadas",
    subtitle = "Top 5 de estaciones más usadas por tipo de usuario",
    x = "Cantidad de viajes",
    y = "Estación de salida",
    fill = "Tipo de usuario"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```

###### Hallazgos clave:
	•	Las estaciones más utilizadas por los miembros anuales se concentran en el centro de la ciudad de Chicago, en zonas de alta circulación.
	•	Este patrón es consistente con un uso frecuente del servicio como medio de transporte cotidiano.
	•	En contraste, las estaciones más utilizadas por los usuarios casuales se ubican principalmente en la zona costera y en áreas cercanas a parques.
	•	Esto refuerza la hipótesis de que los usuarios casuales utilizan el servicio mayormente con fines de ocio o turismo.
	•	Aunque pueda parecer un gráfico secundario, aporta evidencia que complementa los patrones observados anteriormente.

### 6. Recomendaciones
##### 1. Estrategias para incentivar la prueba de la membresía anual
Los usuarios casuales realizan viajes más largos y concentrados en momentos de ocio.
Ofrecer incentivos iniciales (por ejemplo, descuentos o beneficios en el primer período de suscripción) podría incentivar a los usuarios a dar el salto a la membresía anual.

##### 2. Comunicación del valor de la membresía en usuarios con alto tiempo de uso
Dado que los usuarios casuales acumulan mayor duración por viaje, Cyclistic podría mostrar comparativas de ahorro luego de varios viajes largos, destacando cómo la membresía anual resulta más conveniente a mediano/largo plazo frente a pagos individuales.

##### 3. Realizar campañas publicitarias basadas en el comportamiento reciente de los usuarios
Utilizar los patrones detectados de día, hora y duración para lanzar campañas digitales:
	•	Notificaciones tras varios viajes largos
	•	Promociones luego de alto uso en los fines de semana
	•	Mensajes promocionales en las estaciones más usadas por los usuarios casuales


